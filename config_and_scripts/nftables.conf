#!/usr/sbin/nft -f                                                                                                               
                                                                                                                                 
flush ruleset                                                                                                                    
                                                                                                                                 
define SAFE_TRAFFIC_IPS = {                                                                                                      
    172.16.0.0/24,192.168.1.0/24                                                                                                     
}                                                                                                                                
                                                                                                                                 
table inet firewall {                                                                                                            
    chain inbound {                                                                                                              
        type filter hook input priority 0; policy drop;                                                                          
                                                                                                                                 
        # established/related connections                                                                                        
        ct state established,related accept                                                                                      
                                                                                                                                 
        ip protocol 89 accept
                                                                                                    
        iifname lo accept                                                                                                        
                                                                                                                                 
        tcp dport 22 accept                                                                                                                                                                                                          
                                                                                                                                 
        log prefix "[nftables] Inbound Denied: " flags all counter drop                                                          
    }                                                                                                                            
                                                                                                                                 
   chain forward {                                                                                                               
        type filter hook forward priority 0; policy drop;                                                                        
                                                                                                                                 
        ct state established,related accept                                                                                      
                                                                                                                                 
        tcp dport { 8080 } ip saddr $SAFE_TRAFFIC_IPS accept                                                                     
        udp dport { 8080 } ip saddr $SAFE_TRAFFIC_IPS accept                                                                     
                                                                                                                                 
        tcp flags & (syn|fin) == (syn|fin) drop                                                                                  
        tcp flags & (syn|rst) == (syn|rst) drop                                                                                  
        tcp flags & (fin|rst) == (fin|rst) drop                                                                                  
        tcp flags & (ack|fin) == fin drop                                                                                        
        tcp flags & (ack|psh) == psh drop                                                                                        
        tcp flags & (ack|urg) == urg drop                                                                                        
                                                                                                                                 
        log prefix "[nftables] Forward Denied: " flags all counter drop                                                          
   }                                                                                                                             
                                                                                                                                 
   chain outbound {                                                                                                              
        type filter hook output priority 0; policy accept;                                                                       
   }                                                                                                                             
}
